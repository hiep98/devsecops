<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=OneNote.File>
<meta name=Generator content="Microsoft OneNote 15">
<link id=Main-File rel=Main-File href="Build%20-%20push%20stage.htm">
<link rel=File-List href="Build%20-%20push%20stage_files/filelist.xml">
</head>

<body lang=en-US style='font-family:Calibri;font-size:11.0pt'>

<div style='direction:ltr;border-width:100%'>

<div style='direction:ltr;margin-top:0in;margin-left:0in;width:8.5354in'>

<div style='direction:ltr;margin-top:0in;margin-left:.075in;width:2.5465in'>

<h1 style='margin:0in;font-family:Calibri;font-size:20.0pt;color:#0C0C0C'>Build
- push stage</h1>

</div>

<div style='direction:ltr;margin-top:.65in;margin-left:0in;width:8.5354in'>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Create Dockerfile</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#C678DD'>FROM </span><span style='color:#B0935E'>openjdk</span><span
  style='color:#9298A3'>:</span><span style='color:#E06C75'>8-jdk-alpine</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#C678DD'>EXPOSE </span><span style='font-style:italic;
  color:#E06C75'>8080</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#C678DD'>ARG </span><span style='color:#E06C75'>JAR_FILE</span><span
  style='color:#9298A3'>=</span><span style='font-style:italic;color:#E06C75'>target/*.jar</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#C678DD'>ADD </span><span style='color:#E06C75'>${JAR_FILE} </span><span
  style='font-style:italic;color:#E06C75'>app.jar</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#C678DD'>ENTRYPOINT </span><span style='font-style:italic;
  color:#E06C75'>[</span><span style='color:#7DA064'>&quot;java&quot;</span><span
  style='font-style:italic;color:#E06C75'>,</span><span style='color:#7DA064'>&quot;-jar&quot;</span><span
  style='font-style:italic;color:#E06C75'>,</span><span style='color:#7DA064'>&quot;/app.jar&quot;</span><span
  style='font-style:italic;color:#E06C75'>]</span></p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>The dockerfile you
provided will create a Docker container which uses an OpenJDK 8 JVM and exposes
port 8080. The <span style='font-weight:bold'>`ARG`</span> statement allows you
to specify an argument that can be used to customize the contents of the Docker
container. In this case, the argument <span style='font-weight:bold'>`JAR_FILE`</span>
can be used to specify which jar file should be added to the container. The <span
style='font-weight:bold'>`ADD`</span> statement will then add the specified jar
file to the container, and the <span style='font-weight:bold'>`ENTRYPOINT`</span>
statement will set the command to be run when the container is launched. This
will launch the jar file in the container, allowing your application to be
executed.</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>Update Jenkins file:</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>pipeline
  {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  agent any</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  stages {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#5EA9E7'>stage</span><span
  style='color:#9298A3'>(</span><span style='color:#7DA064'>'Build Artifact'</span><span
  style='color:#9298A3'>) {</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; steps {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sh </span><span
  style='color:#7DA064'>&quot;mvn clean package -DskipTests=true&quot;</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  archive </span><span style='color:#7DA064'>'target/*.jar' </span><span
  style='font-style:italic;color:#7F848E'>//so that they can be downloaded
  later</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#5EA9E7'>stage</span><span
  style='color:#9298A3'>(</span><span style='color:#7DA064'>'Unit Tests'</span><span
  style='color:#9298A3'>) {</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; steps {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sh </span><span
  style='color:#7DA064'>&quot;mvn test&quot;</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; post {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; always {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  junit </span><span style='color:#7DA064'>'target/surefire-reports/*.xml'</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  jacoco </span><span style='color:#C49060'>execPattern</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>'target/jacoco.exec'</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#5EA9E7'>stage</span><span
  style='color:#9298A3'>(</span><span style='color:#7DA064'>'Docker Build and
  Push'</span><span style='color:#9298A3'>) {</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; steps {</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
  style='color:#5EA9E7'>withDockerRegistry</span><span style='color:#9298A3'>([</span><span
  style='color:#C49060'>credentialsId</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>&quot;docker-hub&quot;</span><span style='color:#9298A3'>,
  </span><span style='color:#C49060'>url</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>&quot;&quot;</span><span style='color:#9298A3'>]) {</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  sh </span><span style='color:#7DA064'>'printenv'</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  sh </span><span style='color:#7DA064'>'docker build -t
  nthiep1998/numeric-app:&quot;&quot;$GIT_COMMIT&quot;&quot; .'</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
  sh </span><span style='color:#7DA064'>'docker push
  nthiep1998/numeric-app:&quot;&quot;$GIT_COMMIT&quot;&quot;'</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; </p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  &nbsp; &nbsp; &nbsp; } &nbsp; </p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>&nbsp;
  }</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>}</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>In the Jenkins file,
the <span style='font-weight:bold'>`stage('Build Artifact - Maven')`</span>
stage is responsible for building the application code into a jar file, which
is then archived. This step is typically achieved using the Maven build tool,
hence the <span style='font-weight:bold'>`mvn clean package -DskipTests=true`</span>
command to invoke the Maven build. The <span style='font-weight:bold'>`archive
'target/*.jar'`</span> step is then used to archive the built jar file.</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>The Jenkins stage
code you provided is defining a stage in a Jenkins build pipeline. This stage
is responsible for building and pushing a Docker image to a Docker Registry.
The <span style='font-weight:bold'>`withDockerRegistry`</span> step allows the
user to login to the specified Docker Registry using the given credentials. The
<span style='font-weight:bold'>`sh`</span> steps then build the Docker image,
tagging it with the current git commit id, and then pushing the image to the
registry.</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:15.5pt'><span
style='font-weight:bold'>k8s Credentical</span></p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>cat
/root/.kube/config </p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Go to Manage Jenkins
- Credentials System - Global credentials </p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Create kubeconfig
and add file config above</p>

<p style='margin:0in'><img src="Build%20-%20push%20stage_files/image001.png"
width=685 height=96
alt="Dashboard &#10;Manage Jenkins &#10;Credentials &#10;Credentials &#10;P &#10;Store 1 &#10;System &#10;Domain &#10;(global) &#10;ID &#10;kubeconfig &#10;Name &#10;kubeconfig (kubeconfig) "></p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in'><img src="Build%20-%20push%20stage_files/image002.png"
width=683 height=293
alt="Dashboard &#10;Update &#10;Delete &#10;Move &#10;Manage Jenkins &#10;Credentials &#10;System &#10;Global credentials (unrestricted) &#10;kubeconfig (kubeconfig) &#10;Update credentials &#10;Scope &#10;Global (Jenkins, nodes, Items, all child items, etc) &#10;Replace &#10;Filename &#10;kubeconfig &#10;File &#10;Chon tep kubeconfig &#10;kubeconfig &#10;Description ? &#10;kubeconfig "></p>

<p style='margin:0in;font-family:Calibri;font-size:15.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:15.5pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:15.5pt'><span
style='font-weight:bold'>k8s deployment</span></p>

<p style='margin:0in;font-family:Calibri;font-size:13.0pt'>Create file
deployment </p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>apiVersion</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>apps/v1</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>kind</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>Deployment</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>metadata</span><span style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>labels</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>app</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>name</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>spec</span><span style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>replicas</span><span
  style='color:#9298A3'>: </span><span style='color:#C49060'>2</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>selector</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>matchLabels</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#E06C75'>app</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>strategy</span><span
  style='color:#9298A3'>: {}</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>template</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>metadata</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#E06C75'>labels</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
  style='color:#E06C75'>app</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>spec</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; </span><span style='color:#E06C75'>containers</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; - </span><span style='color:#E06C75'>image</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>replace</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
  style='color:#E06C75'>name</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>devsecops-container</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#9298A3'>---</p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>apiVersion</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>v1</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>kind</span><span style='color:#9298A3'>: </span><span
  style='color:#7DA064'>Service</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>metadata</span><span style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>labels</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>app</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>name</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops-svc</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#E06C75'>spec</span><span style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>ports</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; - </span><span style='color:#E06C75'>port</span><span
  style='color:#9298A3'>: </span><span style='color:#C49060'>8080</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>protocol</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>TCP</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>targetPort</span><span
  style='color:#9298A3'>: </span><span style='color:#C49060'>8080</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>selector</span><span
  style='color:#9298A3'>:</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; &nbsp; </span><span style='color:#E06C75'>app</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>devsecops</span></p>
  <p style='margin:0in;font-family:Calibri;font-size:11.5pt'><span
  style='color:#9298A3'>&nbsp; </span><span style='color:#E06C75'>type</span><span
  style='color:#9298A3'>: </span><span style='color:#7DA064'>NodePort</span></p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt;color:#7DA064'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>The code above is a
YAML (YAML Ain’t Markup Language) file that defines two Kubernetes objects: a
Deployment and a Service. </p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>A Deployment is an
object that can create and update a set of identical pods, which are units of
work that run specific containers. A Service is an object that defines a
logical set of pods and a policy by which to access them.</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:13.0pt;color:#111111'>Here
is a line-by-line explanation of the code:</p>

<ul type=disc style='direction:ltr;unicode-bidi:embed;margin-top:0in;
 margin-bottom:0in'>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>apiVersion: apps/v1&nbsp;specifies the API version for the
     Deployment object</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>kind: Deployment&nbsp;specifies the type of object to
     create</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>metadata:&nbsp;contains metadata about the object, such as
     its name and labels</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>labels:&nbsp;assigns key-value pairs to identify the object</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>app: devsecops&nbsp;assigns the label “app” with the value
     “devsecops” to the Deployment</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>name: devsecops&nbsp;assigns the name “devsecops” to the
     Deployment</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>spec:&nbsp;contains the specification of the desired state
     of the object</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>replicas: 2&nbsp;specifies that two pods should be created
     and maintained by this Deployment</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>selector:&nbsp;defines how to select pods that belong to
     this Deployment</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>matchLabels:&nbsp;specifies that only pods with matching
     labels should be selected</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>app: devsecops&nbsp;specifies that only pods with the label
     “app” equal to “devsecops” should be selected</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>strategy: {}&nbsp;specifies an empty strategy for updating
     pods (the default is rolling update)</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>template:&nbsp;defines what each pod should look like</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>metadata:&nbsp;contains metadata about each pod, such as
     its labels</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>labels:&nbsp;assigns key-value pairs to identify each pod</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>app: devsecops&nbsp;assigns the label “app” with the value
     “devsecops” to each pod (this matches with the selector above)</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>spec:&nbsp;contains the specification of each pod’s
     containers and volumes</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>containers:&nbsp;defines one or more containers that run in
     each pod</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>- image: replace&nbsp;specifies that this container should
     use an image named “replace”</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>name: devsecops-container&nbsp;assigns a name to this
     container</span></li>
</ul>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:13.0pt;color:#111111'>The
three dashes indicate a new document in YAML. The following lines define
another Kubernetes object: a Service.</p>

<ul type=disc style='direction:ltr;unicode-bidi:embed;margin-top:0in;
 margin-bottom:0in'>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>apiVersion: v1&nbsp;specifies the API version for the
     Service object (different from apps/v1 for Deployments)</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>kind: Service&nbsp;specifies the type of object to create</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle;margin-top:0pt;
     margin-bottom:8pt'><span style='font-family:Calibri;font-size:11.5pt;
     color:#111111'>metadata:&nbsp;contains metadata about this Service, such
     as its name and labels</span></li>
</ul>

<p style='margin-top:0pt;margin-bottom:8pt;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>The first code block
defines a Kubernetes Deployment. <span style='font-weight:bold'>`apiVersion`</span>
specifies what version of the Kubernetes API the configuration is for, in this
case apps/v1. <span style='font-weight:bold'>`kind`</span> defines the type of
extract, in this case a Deployment. <span style='font-weight:bold'>`metadata`</span>
provides additional configuration such as labels and a name. <span
style='font-weight:bold'>`spec`</span> defines parameters of the deployment
such as the number of replicas, selector, and template. The template defines
container details such as an image and a name.</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>The second code
block defines a Kubernetes Service. <span style='font-weight:bold'>`apiVersion`</span>
specifies the version of the Kubernetes API the configuration is for, in this
case v1. <span style='font-weight:bold'>`kind`</span> defines the type of
resource, in this case a Service. <span style='font-weight:bold'>`metadata`</span>
provides additional configuration such as labels and a name. <span
style='font-weight:bold'>`spec`</span> defines parameters of the service such
as the ports, protocol, targetPort, selector and type. The ports and targetPort
define the port which the Service will be accessible on. </p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>The source code
above creates a Deployment and a Service for an application named “devsecops”.
The Deployment ensures that two pods are always running with a container image
named “replace”. The Service exposes these pods to other pods or external
clients using port 8080.</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>The Deployment and
the Service are linked by the label “app: devsecops”, which means that only
pods with this label will be selected by the Service. The Service uses a type
of NodePort, which means that it assigns a port on each node in the cluster to
forward traffic to the pods.</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>This way, you can
access your application from any node in the cluster using its IP address and
the assigned port. For example, if one of your nodes has an IP address of
192.168.1.10 and the assigned port is 30000, you can access your application by
visiting <a href="http://192.168.1.10:30000">http://192.168.1.10:30000</a>.</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Deploy Node-Service
in Kubernetes Default Namespace:</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>kubectl -n default
  create deploy node-app --image siddharth67/node-service:v1 </p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>kubectl -n default
  expose deploy node-app --name node-service --port 5000</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Using dedocker to
reverse node-service image to dockerfile, we have dockerfile below:</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>FROM
  siddharth67/node-service:v1</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>ADD <a
  href="file://43a95cc218d164ff589cb91519964373d53b607469f5ccce725631916392cd88">file:43a95cc218d164ff589cb91519964373d53b607469f5ccce725631916392cd88</a>
  in /</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>ENV VERSION=v5.7.1
  NPM_VERSION=3</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>RUN /bin/sh -c apk
  add --update curl make gcc g++ python linux-headers paxctl libgcc libstdc++
  binutils-gold \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>curl -sSL <a
  href="https://nodejs.org/dist/$%7bVERSION%7d/node-$%7bVERSION%7d.tar.gz">https://nodejs.org/dist/${VERSION}/node-${VERSION}.tar.gz</a>
  | tar -xz \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>cd /node-${VERSION} \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>./configure --prefix=/usr
  --without-snapshot --fully-static \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>make -j$(grep -c ^processor
  /proc/cpuinfo 2&gt;/dev/null || 1) \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>make install \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>paxctl -cm /usr/bin/node \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>cd / \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>npm install -g npm@${NPM_VERSION} \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>find /usr/lib/node_modules/npm -name
  test -o -name .bin -type d | xargs rm -rf;<span
  style='mso-spacerun:yes'>       </span>apk del curl make gcc g++ python linux-headers
  paxctl binutils-gold \</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>&amp;&amp;<span
  style='mso-spacerun:yes'>       </span>rm -rf /etc/ssl /node-${VERSION}<span
  style='mso-spacerun:yes'>       </span>/usr/share/man /tmp/* /var/cache/apk/*
  /root/.npm /root/.node-gyp<span
  style='mso-spacerun:yes'>                            
  </span>/usr/lib/node_modules/npm/man /usr/lib/node_modules/npm/doc
  /usr/lib/node_modules/npm/html</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>RUN /bin/sh -c
  mkdir -p /usr/src/app</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>WORKDIR
  /usr/src/app</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>COPY
  dir:8980f5119de2a57a2d0613bbfb52aa57920330776afe6414fd673cb49c93f819 in
  /usr/src/app/</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>RUN /bin/sh -c npm
  install</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>EXPOSE 5000</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>CMD
  [&quot;npm&quot; &quot;start&quot;]</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Reference: <a
href="https://raw.githubusercontent.com/mrhavens/Dedockify/master/dedockify.py">https://raw.githubusercontent.com/mrhavens/Dedockify/master/dedockify.py</a></p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>Edit Source code
application:</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>## Within
  /src/main/java/com/devsecops/NumericController.java<span
  style='mso-spacerun:yes'>  </span></p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>## use
  node-service:5000/plusone as baseURL and </p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>## comment the
  localhost:5000</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>private static
  final String baseURL = &quot; <a href="http://node-service:5000/plusone">http://node-service:5000/plusone</a>&quot;;</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'>//private static
  final String baseURL = &quot; <a href="http://localhost:5000/plusone">http://localhost:5000/plusone</a>&quot;;</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:11.5pt'>Update<span
style='mso-spacerun:yes'>  </span>Jenkins file:</p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:8.4562in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'> </span>stage('Kubernetes Deployment - DEV') {</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>      </span>steps {</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>        </span>withKubeConfig([credentialsId:
  'kubeconfig']) {</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>          </span>sh &quot;sed -i
  's#replace#repo/numeric-app:${GIT_COMMIT}#g'
  k8s_deployment_service.yaml&quot;</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>          </span>sh &quot;kubectl apply -f
  k8s_deployment_service.yaml&quot;</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>        </span>}</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>      </span>}</p>
  <p style='margin:0in;font-family:Calibri;font-size:12.0pt'><span
  style='mso-spacerun:yes'>    </span>}</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:Calibri;font-size:12.0pt'>&nbsp;</p>

</div>

</div>

</div>

<div>

<p style='margin:0in'>&nbsp;</p>

<p style='text-align:left;margin:0in;font-family:Arial;font-size:9pt;
color:#969696;direction:ltr'>Created with OneNote.</p>

</div>

</body>

</html>
